## æ¦‚è¿°

![img](C:\Users\Administrator\Desktop\æ–‡æ¡£è®°å½•ã€éœ€æ±‚æ–‡æ¡£\å­¦ä¹ è®°å½•\è·¯ç”±\å›¾ç‰‡\1.png)

> è°ˆåˆ°è·¯ç”±ï¼Œä¸€èˆ¬åˆ†ä¸ºå‰ç«¯è·¯ç”±å’Œåç«¯è·¯ç”±ä¸¤ç§ï¼Œåç«¯è·¯ç”±æŒ‡çš„å½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨åˆ‡æ¢ä¸åŒURLæ—¶ï¼Œéƒ½ä¼šå‘æœåŠ¡å™¨å‘èµ·èµ„æºè¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡åç«¯è·¯ç”±åŒ¹é…ä¹‹åæ ¹æ®ä¸åŒURLè¿”å›ä¸åŒé¡µé¢ï¼Œè€Œå‰ç«¯è·¯ç”±åˆ™å°†æµè§ˆå™¨ä¸æœåŠ¡å™¨äº¤äº’(é¡µé¢è·³è½¬çš„URLè§„åˆ™åŒ¹é…)çš„ä»»åŠ¡äº¤ç»™å‰ç«¯æ¥åš

### **1.å‰ç«¯è·¯ç”±æ¨¡å¼**

> ç›®å‰å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æˆä¸ºç›®å‰å‰ç«¯åº”ç”¨çš„ä¸»æµï¼Œè€Œå¤§å‹å•é¡µåº”ç”¨çš„ä¸€ä¸ªå¤§ç‰¹å¾æ˜¯ï¼Œç”±å‰ç«¯è·¯ç”±æ¥æ§åˆ¶é¡µé¢çš„è·³è½¬ï¼Œé€šè¿‡urlçš„åˆ‡æ¢ï¼Œåœ¨ä¸è¯·æ±‚æœåŠ¡å™¨çš„å‰æï¼Œæ›´æ–°é¡µé¢è§†å›¾ï¼Œè¿™é‡Œä»¥vue-routerä¸ºä¾‹åˆ†æï¼Œå‰ç«¯è·¯ç”±æ¨¡å¼ä¸»è¦åŒ…æ‹¬ä¸¤ç§ï¼šhashæ¨¡å¼å’Œhistoryæ¨¡å¼

#### 1.1 hash æ¨¡å¼

> hashæ¨¡å¼å³æ˜¯é€šè¿‡ hash å€¼ï¼ˆç±»ä¼¼é”šç‚¹ï¼‰çš„å˜åŒ–ï¼Œæµè§ˆå™¨ä¸ç”¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œä¹Ÿå°±æ— éœ€åˆ·æ–°é¡µé¢ã€‚è€Œæµè§ˆå™¨æ˜¯æ€ä¹ˆç›‘å¬å˜åŒ–çš„å‘¢ï¼Ÿå°±æ˜¯é€šè¿‡urlä¸­hash å€¼çš„å˜åŒ–ï¼Œæ­¤æ—¶è¿˜å¥½è§¦å‘ hashchange äº‹ä»¶ï¼Œé€šè¿‡æ­¤äº‹ä»¶çš„è§¦å‘æˆ‘ä»¬å°±å¯ä»¥æ¸…æ™°çŸ¥é“hashå‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–

å‡è®¾ä½ æµè§ˆå™¨è®¿é—®çš„urlåœ°å€æ˜¯ http://127.0.0.1/#/test é‚£ä¹ˆé€šè¿‡ location.hash è·å–çš„hashå€¼ä¸º #/test

å¯¼è‡´è·¯ç”±çš„å˜åŒ–æ— éæ˜¯ä¸‰ç§æƒ…å†µï¼šåˆ·æ–°é¡µé¢ã€æµè§ˆå™¨è¿”å›æ“ä½œã€æ–°é“¾æ¥è·³è½¬ï¼Œä¸‹é¢æ˜¯å…·ä½“æµç¨‹å›¾ğŸ‘‡

![img](C:\Users\Administrator\Desktop\æ–‡æ¡£è®°å½•ã€éœ€æ±‚æ–‡æ¡£\å­¦ä¹ è®°å½•\è·¯ç”±\å›¾ç‰‡\2.png)

é‚£hashæ¨¡å¼ä¸‹ç›‘å¬è·¯ç”±å˜åŒ–å®ç°çš„åŸç†æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

```
window.addEventListener('hashchange', this.onHashChange.bind(this))
window.addEventListener('load', this.onHashChange.bind(this))
function onHashChange(){
// todo åŒ¹é… hash åš dom æ›´æ–°æ“ä½œ
}
å¤åˆ¶ä»£ç 
```

æœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥ç ”ç©¶vue-routerå…³äºhashç±»çš„å…·ä½“æºç å®ç° [ç‚¹æˆ‘åˆ°è¾¾ç«ç®­](https://github.com/vuejs/vue-router/blob/dev/src/history/hash.js)

#### 1.2 history æ¨¡å¼

> è‡ªHTML5æ–°æ ‡å‡†å‡ºå°ï¼ŒpushStateå’ŒreplaceStateæ˜¯HTML5çš„æ–°æ¥å£ï¼Œé€šè¿‡è¿™ä¸¤ä¸ª API å¯ä»¥æ”¹å˜ url åœ°å€ä¸”ä¸ä¼šå‘é€è¯·æ±‚ï¼Œå‰ç«¯è·¯ç”±ä»æ­¤äº†å¤šäº†å¦å¤–ä¸€ç§æ¨¡å¼Historyï¼Œè€Œä¸”é€šè¿‡è¿™ç§æ¨¡å¼ä¸å†éœ€è¦åœ¨URLæ·»åŠ #ç¬¦å·ï¼Œä¹Ÿèƒ½è®©URLæ˜¾å¾—æ›´åŠ ä¼˜ç¾

æˆ‘ä»¬å…ˆçœ‹çœ‹window.historyå¯¹è±¡é‡Œé¢æœ‰ä»€ä¹ˆ

![img](C:\Users\Administrator\Desktop\æ–‡æ¡£è®°å½•ã€éœ€æ±‚æ–‡æ¡£\å­¦ä¹ è®°å½•\è·¯ç”±\å›¾ç‰‡\3.png)

History.pushState

> åœ¨ä¸åˆ·æ–°æµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºæ–°çš„æµè§ˆè®°å½•å¹¶æ’å…¥æµè§ˆè®°å½•é˜Ÿåˆ—ä¸­,å½“åˆ·æ–°é¡µé¢ï¼Œé¡µé¢å†…å®¹ä¸å˜ä½†åœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼Œè¯¥APIå¯ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯

- çŠ¶æ€å¯¹è±¡ï¼ˆstateObjectï¼‰ï¼š å¯ä»¥é€šè¿‡pushStateæ–¹æ³•å¯ä»¥å°†stateObjectï¼ˆå¯¹è±¡ï¼‰å†…å®¹ä¼ é€’åˆ°æ–°é¡µé¢ä¸­
- æ ‡é¢˜ï¼ˆtitleï¼‰ï¼šå¯ä¸ä¼ 
- åœ°å€ï¼ˆurlï¼‰ï¼šæ–°çš„å†å²è®°å½•æ¡ç›®çš„åœ°å€ï¼ˆurlä¸æ”¯æŒè·¨åŸŸï¼‰ï¼›

```
window.history.pushState({data: "test"}, "", 'http://127.0.0.1/test');
```

History.replaceState:

> çš„ä½¿ç”¨ä¸ history.pushState() ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºpushStateä¼šå¢åŠ ä¸€æ¡æ–°çš„å†å²è®°å½•ï¼Œè€ŒreplaceStateåˆ™ä¼šæ›¿æ¢å½“å‰çš„å†å²è®°å½•ï¼ŒæŠŠå½“å‰çš„å†å²è®°å½•æ”¹æˆç›®æ ‡åœ°å€

```
window.history.replaceState({data: "test"}, "", 'http://127.0.0.1/test');
```

popstate

> å½“ç”¨æˆ·å‘èµ·è¿”å›æ“ä½œæˆ–è€…æ‰§è¡Œhistory.go()æˆ–history.forward()ç­‰æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘popstate

```
 window.addEventListener('popstate', e => {
    //todo 
 });
```

è®²å®Œhistoryæ¨¡å¼æ¶‰åŠåˆ°æ¥å£ï¼Œæ ‘é…±èŠèŠé…ç½®historyæ¨¡å¼éœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼Œè¿™ç§æ¨¡å¼ç›¸æ¯”hashæ¨¡å¼è¿˜éœ€è¦é…ç½®åç«¯ï¼Œå¦‚æœåå°æ²¡æœ‰æ­£ç¡®çš„é…ç½®ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ç›´æ¥åˆ·æ–°   http://127.0.0.1/#/test å°±ä¼šè¿”å› 404ï¼Œé‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ ğŸ¤”ï¸

ä½ éœ€è¦åœ¨Nginxé…ç½®æ–‡ä»¶æ·»åŠ é‡å®šå‘ é™„ä¸Š [history vue-routerå®˜æ–¹æ–‡æ¡£](https://router.vuejs.org/zh/guide/essentials/history-mode.html)

```
location / {
  try_files $uri $uri/ /index.html;
}
```

Vue-router Historyæ¨¡å¼ä¸‹çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º

![img](C:\Users\Administrator\Desktop\æ–‡æ¡£è®°å½•ã€éœ€æ±‚æ–‡æ¡£\å­¦ä¹ è®°å½•\è·¯ç”±\å›¾ç‰‡\4.png)

æœ‰å…´è¶£Vue-routerå…³äºhistoryç±»çš„å…·ä½“æºç å®ç° [ç‚¹æˆ‘åˆ°è¾¾ç«ç®­](https://github.com/vuejs/vue-router/blob/dev/src/history/html5.js)

### **2.è·¯ç”±åº”ç”¨**

> èŠèŠvue-routerçš„ä¸€äº›åº”ç”¨åœºæ™¯

#### 2.1 è·¯ç”±æ‹¦æˆª

> è·¯ç”±æ‹¦æˆªå¯ä»¥ç”¨æ¥ä½œä¸ºå‰ç«¯é‰´æƒå…¥å£ï¼Œæ¯”å¦‚åˆ¤æ–­æ˜¯å¦æ˜¯å·²ç™»å½•çŠ¶æ€

```
mport Vue from 'vue'
import Router from 'vue-router'
Vue.use(Router)
const router = new Router({
 routes: [
 {
  path: '/home',''
  component: () => import('@/components/Home')
  }
 },{
  path: '/login',
  name: 'login',
  component: (resolve) => {
  component: () => import('@/components/Login')
  }
 }}]
})
// åˆ¤æ–­æ˜¯å¦éœ€è¦ç™»å½•æƒé™ ä»¥åŠæ˜¯å¦ç™»å½•
router.beforeEach((to, from, next) => {
 if (to.matched.some(res => res.meta.requireAuth)) { // åˆ¤æ–­è·¯ç”±æ˜¯å¦éœ€è¦ç™»å½•æƒé™
 if (localStorage.getItem('item')) { //åˆ¤æ–­æ˜¯å¦æœ‰token
  next()
 } else {// æ²¡ç™»å½•åˆ™è·³è½¬åˆ°ç™»å½•ç•Œé¢
  next({
  path: '/login',
  query: {redirect: to.fullPath}
  })
 }
 } else {
 next()
 }
})
export default router
```



#### 2.2 è·¯ç”±æ‡’åŠ è½½

> æ‡’åŠ è½½ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç­‰éœ€è¦å†åŠ è½½ï¼Œåœ¨SPAåº”ç”¨ä¸­ï¼Œå¦‚æœä¸é€šè¿‡æ‡’åŠ è½½åŠ è½½ç»„ä»¶çš„æ–¹å¼ï¼Œä¼šå¯¼è‡´webpackæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ä½“åˆ¶è¿‡å¤§,è¿›è€Œå½±å“ç”¨æˆ·ä½“éªŒ

```
export default new Router({                                
  routes: [
    {
      path: '/home',                                            
      name: 'home',
      component: () => import('@/components/Home') # æ‡’åŠ è½½å¼•å…¥ç»„ä»¶
    }
  ]
});
```

#### 2.3 è·¯ç”±æ¨¡å—åŒ–ç®¡ç†

> ä½ æ˜¯å¦è¿˜åœ¨çƒ¦æ¼å¦‚ä½•æŒ‰ä¸åŒæ¨¡å—ä¸åŒåŠŸèƒ½ç®¡ç†ä¸åŒè·¯ç”±ï¼Œè¿™é‡Œè¦æ¨èä½¿ç”¨ require.context()

ä¸åŒåŠŸèƒ½æ¨¡å—åŒºåˆ†ï¼Œå†é€šè¿‡require.context å¯¼å‡ºæ‰€æœ‰è·¯ç”±

![img](C:\Users\Administrator\Desktop\æ–‡æ¡£è®°å½•ã€éœ€æ±‚æ–‡æ¡£\å­¦ä¹ è®°å½•\è·¯ç”±\å›¾ç‰‡\5.png)

> require.context() å®ƒå…è®¸ä¼ å…¥ä¸€ä¸ªç›®å½•è¿›è¡Œæœç´¢ï¼Œä¸€ä¸ªæ ‡å¿—è¡¨ç¤ºæ˜¯å¦ä¹Ÿåº”è¯¥æœç´¢å­ç›®å½•ï¼Œä»¥åŠä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ–‡ä»¶,å½“ä½ æ„å»ºé¡¹ç›®æ—¶ï¼Œwebpackä¼šå¤„ç†require.contextçš„å†…å®¹

require.context()å¯ä¼ å…¥ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼š

- directory ï¼šè¯»å–æ–‡ä»¶çš„è·¯å¾„
- useSubdirectories ï¼šæ˜¯å¦éå†æ–‡ä»¶çš„å­ç›®å½•
- regExpï¼š åŒ¹é…æ–‡ä»¶çš„æ­£åˆ™

å®é™…åº”ç”¨å¦‚ä¸‹ğŸ‘‡

![img](C:\Users\Administrator\Desktop\æ–‡æ¡£è®°å½•ã€éœ€æ±‚æ–‡æ¡£\å­¦ä¹ è®°å½•\è·¯ç”±\å›¾ç‰‡\6.png)

routeså¯¼å‡ºæ¥ç»“æœæ˜¯è¿™æ ·

![img](C:\Users\Administrator\Desktop\æ–‡æ¡£è®°å½•ã€éœ€æ±‚æ–‡æ¡£\å­¦ä¹ è®°å½•\è·¯ç”±\å›¾ç‰‡\7.png)

å½“ç„¶åŸæœ¬çš„å®šä¹‰è·¯ç”±çš„æ–¹å¼ä¹Ÿå˜äº†

```
/*
 * ä¸ªäººä¸­å¿ƒè·¯ç”±æ¨¡å—ï¼ˆuserï¼‰
 * @Author: tree
 * @Date: 2019-11-06 20:20:51
 */
export default [
  {
    path: '/user/info',
    name: 'personalInfo',
    component: () => import('@/views/user/info.vue'),
    meta: { title: 'è´¦å·ä¿¡æ¯', keepAlive: false, showHeader: true },
  },
  {
    path: '/user/security',
    name: 'security',
    component: () => import('@/views/user/security.vue'),
    meta: { title: 'å®‰å…¨è®¾ç½®', keepAlive: false, showHeader: true },
  },
];
```

#### 2.4 å…¶ä»–å¸¸è§è·¯ç”± API

- window.history.back() : åŠ è½½ history åˆ—è¡¨ä¸­çš„å‰ä¸€ä¸ª URL
- window.history.forward() : åŠ è½½ history åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ª URL
- window.history.back(n) : åŠ è½½ history åˆ—è¡¨ä¸­çš„æŸä¸ªé¡µé¢
- window.location.href: è¿”å›å®Œæ•´çš„URL
- window.location.hash: è¿”å›URLçš„é”šéƒ¨åˆ†
- window.location.pathname: è¿”å›URLè·¯å¾„å


