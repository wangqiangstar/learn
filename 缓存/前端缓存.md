## æ¦‚è¦

![](C:\Users\Administrator\Desktop\æ–‡æ¡£è®°å½•ã€éœ€æ±‚æ–‡æ¡£\å­¦ä¹ è®°å½•\ç¼“å­˜\å›¾ç‰‡\1.png)

> å‰ç«¯ç¼“å­˜æŒ‡çš„æ˜¯ï¼Œæµè§ˆå™¨å¯¹æœåŠ¡å™¨æœ€è¿‘è¯·æ±‚è¿‡çš„èµ„æºè¿›è¡Œå­˜å‚¨ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥è¾¾åˆ°å‡å°‘ä¸æœåŠ¡å™¨çš„äº¤äº’è¯·æ±‚ï¼Œä»¥æ­¤å‡å°‘å¯¹å¸¦å®½æµé‡çš„æµªè´¹ï¼Œä»¥åŠå‡å°‘äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œè€Œæµè§ˆå™¨ç¼“å­˜ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼Œå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜

### 1.å¼ºç¼“å­˜

> å¼ºç¼“å­˜æ‰€è°“çš„â€œå¼ºâ€ï¼Œåœ¨äºå¼ºåˆ¶è®©æµè§ˆå™¨æŒ‰ç…§ä¸€å®šæ—¶é—´èŒƒå›´å†…æ¥å­˜å‚¨æ¥è‡ªæœåŠ¡å™¨çš„èµ„æºï¼Œæœ‰ç‚¹å¼ºåˆ¶çš„å‘³é“ï½ï¼Œå¼ºç¼“å­˜æ˜¯åˆ©ç”¨Expiresæˆ–è€…Cache-Controlï¼Œä¸å‘é€è¯·æ±‚ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­å–ï¼Œè¯·æ±‚çŠ¶æ€ç ä¼šè¿”å›200ï¼ˆfrom cacheï¼‰

#### 1.1 Expires(å·²é€æ­¥æ·˜æ±°)

> Expiresæ˜¯HTTP/1.0ä¸­æåŠçš„ï¼Œè®©æœåŠ¡å™¨ä¸ºæ–‡ä»¶èµ„æºè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œåœ¨å¤šé•¿æ—¶é—´å†…å¯ä»¥å°†è¿™äº›å†…å®¹è§†ä¸ºæœ€æ–°çš„ï¼Œå…è®¸å®¢æˆ·ç«¯åœ¨è¿™ä¸ªæ—¶é—´ä¹‹å‰ä¸å»æ£€æŸ¥ï¼ŒMDN å…·ä½“ä»‹ç» [ç‚¹æ­¤](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Expires)

- æŒ‡å®šåˆ°æœŸæ—¶é—´

æŒ‡å®šç¼“å­˜åˆ°æœŸGMTçš„ç»å¯¹æ—¶é—´ï¼Œå¦‚æœexpiresåˆ°æœŸéœ€è¦é‡æ–°è¯·æ±‚

```
Expires:Sat, 09 Jun 2020 08:13:56 GMT
å¤åˆ¶ä»£ç 
```

#### 1.2 Cache-Controlï¼ˆä¸»è¦ï¼‰

> ç›¸æ¯”ä¸Šä¸€å°èŠ‚è®²çš„ expiresï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ Cache-Control ä½ å¯ä»¥ç†è§£æˆä¸ºé«˜çº§ç‰ˆexpiresï¼Œä¸ºäº†å¼¥è¡¥Expiresçš„ç¼ºé™·åœ¨Http1.1åè®®å¼•å…¥çš„ï¼Œä¸”å¼ºå¤§ä¹‹å¤–ä¼˜å…ˆçº§ä¹Ÿæ›´é«˜ï¼Œä¹Ÿå°±æ˜¯å½“Expireså’ŒCache-ControlåŒæ—¶å­˜åœ¨æ—¶ï¼ŒCache-Control ä¼šè¦†ç›–Expiresçš„é…ç½®ï¼Œå³Cache-Control ( Http 1.1 ) > Expires ( Http 1.0 )

Cache-Control æ¯”Expiresæ¯”è¾ƒè¦å†…æ¶µï¼Œå…·å¤‡æ›´å¤šçš„å±æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬å¦‚ä¸‹

â€¢ no-cache ï¼šå¯ä»¥åœ¨æœ¬åœ°ç¼“å­˜ï¼Œå¯ä»¥åœ¨ä»£ç†æœåŠ¡å™¨ç¼“å­˜ï¼Œéœ€è¦å…ˆéªŒè¯æ‰å¯ä½¿ç”¨ç¼“å­˜

â€¢ no-store ï¼š ç¦æ­¢æµè§ˆå™¨ç¼“å­˜ï¼Œåªèƒ½é€šè¿‡æœåŠ¡å™¨è·å–

â€¢ max-age ï¼š è®¾ç½®èµ„æºçš„è¿‡æœŸæ—¶é—´ï¼ˆæ•ˆæœä¸expiresä¸€æ ·ï¼‰

ä¾‹å­æ¼”ç¤ºï¼š

```
// è®¾ç½®ç¼“å­˜æ—¶é—´ä¸º1å¹´
Cache-Control: max-age=31536000
Expires:Sat, 09 Jun 2020 08:13:56 GMT //åŒæ—¶è®¾ç½®ä¸¤ä¸ªï¼ŒExpiresä¼šå¤±æ•ˆ
å¤åˆ¶ä»£ç 
```

åˆ™æ„å‘³ç€æµè§ˆå™¨å¯ä»¥ç¼“å­˜ä¸€å¹´çš„æ—¶é—´ï¼Œæ— éœ€è¯·æ±‚æœåŠ¡å™¨ï¼ŒåŒæ—¶å¦‚æœåŒæ—¶å£°æ˜Expireså’ŒCache-Controlï¼ŒExpireså°†å¤±æ•ˆ

> ğŸ¤”ï¸ä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘Cache-Control no-cacheä¸max-age=0æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

æœ¬è´¨ä¸Šå°±æ˜¯ä½ æŒ‰æµè§ˆå™¨åˆ·æ–°ä¸å¼ºåˆ¶åˆ·æ–°çš„åŒºåˆ†ï¼Œçœ‹ä¸‹ä¸€èŠ‚

#### 1.3 ç”¨æˆ·å¯¹æµè§ˆå™¨çš„æ“ä½œ

> ç›¸ä¿¡ä½ ç¦»ä¸å¼€çš„æ“ä½œå°±æ˜¯F5ï¼ˆåˆ·æ–°æŒ‰é’®ï¼‰ï¼Œä½†æ˜¯ä¸åŒçš„åˆ·æ–°æ“ä½œæ„å‘³ç€ä¸åŒçš„ååº”

â€¢ Ctrl + F5 (å¼ºåˆ¶åˆ·æ–°)ï¼šï¼šrequest headerå¤šäº†cache-controlï¼š no-cache ï¼ˆé‡æ–°è·å–è¯·æ±‚ï¼‰

â€¢ F5 (åˆ·æ–°)/ctrl+Råˆ·æ–°ï¼šï¼šrequest headerå¤šäº† cache-controlï¼š max-age=0 ï¼ˆéœ€è¦å…ˆéªŒè¯æ‰å¯ä½¿ç”¨ç¼“å­˜ï¼ŒExpiresæ— æ•ˆï¼‰

### 2.åå•†ç¼“å­˜

> åå•†ç¼“å­˜ï¼Œå°±æ²¡æœ‰å¼ºç¼“å­˜é‚£ä¹ˆéœ¸é“ï¼Œåå•†ç¼“å­˜éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤ç«¯è¿›è¡Œäº¤äº’ï¼Œé€šè¿‡æœåŠ¡å™¨å‘ŠçŸ¥æµè§ˆå™¨ç¼“å­˜æ˜¯å¦å¯ç”¨ï¼Œå¹¶å¢åŠ ç¼“å­˜æ ‡è¯†ï¼Œâ€œæœ‰äº‹å¥½å¥½å•†é‡â€ï¼Œä¸¤è€…éƒ½ä¼šäº’ç›¸åå•†ã€‚ åå•†ç¼“å­˜ï¼Œå…¶å®å°±æ˜¯æœåŠ¡å™¨ä¸æµè§ˆå™¨äº¤äº’è¿‡ç¨‹ï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªå›åˆï¼Œè€Œåå•†ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

#### 2.1 Last-Modified ï¼ˆHttp 1.0ï¼‰

â€¢ ç¬¬ä¸€å›åˆï¼šå½“æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨é€šè¿‡Last-Modified æ¥è®¾ç½®å“åº”å¤´çš„ç¼“å­˜æ ‡è¯†ï¼ŒæŠŠèµ„æºæœ€åä¿®æ”¹çš„æ—¶é—´ä½œä¸ºå€¼å†™å…¥ï¼Œå†å°†èµ„æºè¿”å›ç»™æµè§ˆå™¨

â€¢ ç¬¬äºŒå›åˆï¼šç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šå¸¦ä¸Š If-Modified-Since è¯·æ±‚å¤´å»è®¿é—®æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°† If-Modified-Since ä¸­æºå¸¦çš„æ—¶é—´ä¸èµ„æºä¿®æ”¹çš„æ—¶é—´å¯¹æ¯”ï¼Œå½“æ—¶é—´ä¸ä¸€è‡´æ—¶ï¼Œæ„å‘³æ›´æ–°äº†ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›æ–°èµ„æºå¹¶æ›´æ–°Last-Modifiedï¼Œå½“æ—¶é—´ä¸€è‡´æ—¶ï¼Œæ„å‘³ç€èµ„æºæ²¡æœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›304çŠ¶æ€ç ï¼Œæµè§ˆå™¨å°†ä»ç¼“å­˜ä¸­è¯»å–èµ„æº

```
//response header ç¬¬ä¸€å›åˆ
Last-Modified: Wed, 21 Oct 2019 07:28:00 GMT

//request header ç¬¬äºŒå›åˆ
If-Modified-Since: Wed, 21 Oct 2019 07:29:00 GMT 
å¤åˆ¶ä»£ç 
```

#### 2.2 Etag ï¼ˆHttp 1.1ï¼‰

> MDNä¸­æåˆ°ETag ä¹‹é—´çš„æ¯”è¾ƒï¼Œä½¿ç”¨çš„æ˜¯å¼ºæ¯”è¾ƒç®—æ³•ï¼Œå³åªæœ‰åœ¨æ¯ä¸€ä¸ªå­—èŠ‚éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥è®¤ä¸ºä¸¤ä¸ªæ–‡ä»¶æ˜¯ç›¸åŒçš„ï¼Œè€Œè¿™ä¸ªhashå€¼ï¼Œæ˜¯ç”±å¯¹æ–‡ä»¶çš„ç´¢å¼•èŠ‚ã€å¤§å°å’Œæœ€åä¿®æ”¹æ—¶é—´è¿›è¡ŒHashåå¾—åˆ°çš„ï¼Œè€Œä¸”è¦æ³¨æ„çš„æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸é€‚ç”¨ï¼Œäº†è§£æ›´å¤š[ç‚¹æˆ‘](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Match)

â€¢ ç¬¬ä¸€å›åˆï¼š ä¹Ÿæ˜¯è·Ÿä¸Šæ–‡ä¸€æ ·ï¼Œæµè§ˆå™¨å»è¯·æ±‚æœåŠ¡å™¨èµ„æºï¼Œä¸è¿‡è¿™æ¬¡ä¸æ˜¯é€šè¿‡Last-Modifiedäº†ï¼Œè€Œæ˜¯ç”¨Etagæ¥è®¾ç½®å“åº”å¤´ç¼“å­˜æ ‡è¯†ã€‚Etagæ˜¯ç”±æœåŠ¡ç«¯ç”Ÿæˆçš„ï¼Œç„¶åæµè§ˆå™¨ä¼šå°†Etagä¸èµ„æºç¼“å­˜

â€¢ ç¬¬äºŒå›åˆ:  æµè§ˆå™¨ä¼šå°† Etag æ”¾å…¥ If-None-Match è¯·æ±‚å¤´ä¸­å»è®¿é—®æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°åï¼Œä¼šå¯¹æ¯”ä¸¤ç«¯çš„æ ‡è¯†ï¼Œå½“ä¸¤è€…ä¸ä¸€è‡´æ—¶ï¼Œæ„å‘³ç€èµ„æºæ›´æ–°ï¼Œä¼šä»æœåŠ¡å™¨çš„å“åº”è¯»å–èµ„æºå¹¶æ›´æ–°Etagï¼Œæµè§ˆå™¨å°†ä»ç¼“å­˜ä¸­è¯»å–èµ„æºï¼Œå½“ä¸¤è€…ä¸€è‡´æ—¶ï¼Œæ„å‘³ç€èµ„æºæ²¡æœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›304çŠ¶æ€ç ï¼Œæµè§ˆå™¨å°†ä»ç¼“å­˜ä¸­è¯»å–èµ„æº

```
//response header ç¬¬ä¸€å›åˆ
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"

//request header ç¬¬äºŒå›åˆ
If-None-Match: "33a64df551425fcc55e4d42a148795d9f25f89d4"
å¤åˆ¶ä»£ç 
```

å¯¹æ¯”å®Œ Last-Modified ä¸ Etagï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜¾ç„¶çœ‹åˆ°ï¼Œåå•†ç¼“å­˜æ¯æ¬¡è¯·æ±‚éƒ½ä¼šä¸æœåŠ¡å™¨å‘ç”Ÿâ€œå…³ç³»â€ï¼Œç¬¬ä¸€å›åˆéƒ½æ˜¯æ‹¿æ•°æ®å’Œæ ‡è¯†ï¼Œè€Œç¬¬äºŒå›åˆå°±æ˜¯æµè§ˆå™¨â€œå’¨è¯¢â€æœåŠ¡å™¨æ˜¯å¦èµ„æºå·²ç»æ›´æ–°çš„è¿‡ç¨‹ã€‚

åŒæ—¶ï¼Œå¦‚æœä»¥ä¸Šä¸¤ç§æ–¹å¼åŒæ—¶ä½¿ç”¨ï¼ŒEtag ä¼˜å…ˆçº§ä¼šæ›´é«˜ï¼Œå³ Etag( Http 1.1 ) > Last-Modified ( Http 1.0 )

### 3.ç¼“å­˜çŠ¶æ€ç 

#### 3.1 çŠ¶æ€ç 200 OKï¼ˆfrom cacheï¼‰

> è¿™æ˜¯æµè§ˆå™¨æ²¡æœ‰è·ŸæœåŠ¡å™¨ç¡®è®¤ï¼Œç›´æ¥ç”¨äº†æµè§ˆå™¨ç¼“å­˜ï¼Œæ€§èƒ½æœ€å¥½çš„ï¼Œæ²¡æœ‰ç½‘ç»œè¯·æ±‚ï¼Œé‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿä¸€èˆ¬åœ¨expiresæˆ–è€… Cache-Control ä¸­çš„max-ageå¤´éƒ¨æœ‰æ•ˆæ—¶ä¼šå‘ç”Ÿ

#### 3.2 çŠ¶æ€ç 304 Not Modified

> æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨â€œäº¤æµâ€äº†ï¼Œç¡®å®šä½¿ç”¨ç¼“å­˜åï¼Œå†ç”¨ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒèŠ‚è®²çš„é€šè¿‡Etagæˆ–Last-Modifiedçš„ç¬¬äºŒå›åˆä¸­å¯¹æ¯”ï¼Œå¯¹æ¯”ä¸¤è€…ä¸€è‡´ï¼Œåˆ™æ„å‘³èµ„æºä¸æ›´æ–°ï¼Œåˆ™æœåŠ¡å™¨è¿”å›304çŠ¶æ€ç 

#### 3.3 çŠ¶æ€ç  200

> ä»¥ä¸Šä¸¤ç§ç¼“å­˜å…¨éƒ½å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯æœªç¼“å­˜æˆ–è€…ç¼“å­˜æœªè¿‡æœŸï¼Œéœ€è¦æµè§ˆå™¨å»è·å–æœ€æ–°çš„èµ„æºï¼Œæ•ˆç‡æœ€ä½ ä¸€å¥è¯ï¼šç¼“å­˜æ˜¯å¦è¿‡æœŸç”¨ï¼šCache-Controlï¼ˆmax-ageï¼‰, Expiresï¼Œç¼“å­˜æ˜¯å¦æœ‰æ•ˆç”¨ï¼šLast-Modifiedï¼ŒEtag

### 4.ç¼“å­˜çš„åº”ç”¨

> è®²è¿°ç¼“å­˜åœ¨æˆ‘ä»¬å¼€å‘ä¸­æœ€å¸¸è§çš„ä½¿ç”¨

#### 4.1 Vueä¸­ç¼“å­˜çš„åº”ç”¨

â€¢ keepAlive

> vueå®˜æ–¹æ–‡æ¡£æåˆ°ï¼Œå½“åœ¨è¿™äº›ç»„ä»¶ä¹‹é—´åˆ‡æ¢çš„æ—¶å€™ï¼Œä½ æœ‰æ—¶ä¼šæƒ³ä¿æŒè¿™äº›ç»„ä»¶çš„çŠ¶æ€ï¼Œä»¥é¿å…åå¤é‡æ¸²æŸ“å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¸Œæœ›é‚£äº›æ ‡ç­¾çš„ç»„ä»¶å®ä¾‹èƒ½å¤Ÿè¢«åœ¨å®ƒä»¬ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºçš„æ—¶å€™ç¼“å­˜ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª  å…ƒç´ å°†å…¶åŠ¨æ€ç»„ä»¶åŒ…è£¹èµ·æ¥ [å®˜æ–¹æ–‡æ¡£ğŸš€](https://cn.vuejs.org/v2/api/#keep-alive)

ä¸»è¦ç”¨äºä¿ç•™ç»„ä»¶çŠ¶æ€æˆ–é¿å…é‡æ–°æ¸²æŸ“ï¼Œä¹Ÿæ„å‘³ç€ä¸ä¼šå†èµ°mountedï¼ŒbeforeDestroyå‡½æ•°ï¼Œç»„ä»¶å°†è¢«ç¼“å­˜ï¼Œä¸ç”¨é”€æ¯é‡æ–°æ¸²æŸ“ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½

è·¯ç”±çš„é€‰æ‹©æ€§ç¼“å­˜

```
// router.js
export default new Router({
routes:[
   { path: '/test',
    name: 'test',
    component: () => import('@/views/test/test.vue'),
    meta: {
      title: 'æµ‹è¯•',
      keepAlive: true
    }
  },
  
 // App.vue
 <keep-alive v-if='$route.meta.keepAlive'>
   <router-view></router-view>
</keep-alive>
 <router-view v-if='!$route.meta.keepAlive'></router-view>
å¤åˆ¶ä»£ç 
```

ç»„ä»¶ç¼“å­˜

```
 <keep-alive>
  <component v-bind:is="currentTabComponent"></component>
</keep-alive>
å¤åˆ¶ä»£ç 
```

- æ‰“åŒ…åŠ å…¥hash

> å‰ç«¯å·¥ç¨‹åŒ–å¼€å‘ï¼Œå¯ä»¥ä½¿ç”¨ Webpack ç¼–è¯‘ï¼Œæ‰“åŒ…çš„èµ„æºæ–‡ä»¶è·¯å¾„é‡Œè‡ªåŠ¨å¸¦æœ‰ä¸€ä¸²éšæœºå­—ç¬¦ä¸²ï¼Œç§°ä¸º hash

åœ¨vue cliè„šæ‰‹æ¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®vue.config.js(æœ¬è´¨ä¸Šæ˜¯é…ç½®webpack)æ¥è®¾ç½®ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶å…·å¤‡hashå€¼ï¼Œæ„å‘³ç€æ¯æ¬¡æ‰“åŒ…ç¼–è¯‘çš„æ–‡ä»¶éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ¥é˜²æ­¢å› ä¸ºç¼“å­˜ï¼Œå¯¼è‡´èµ„æºæ²¡æœ‰æ›´æ–°ï¼Œ[å®˜æ–¹æ–‡æ¡£ğŸš€](https://cli.vuejs.org/zh/config/#filenamehashing)

Vue-Cli 3xç‰ˆæœ¬

```
// vue.config.js
module.exports = { 
  filenameHashing: true,
  chainWebpack: (config) => {
      config.output.filename('[name].[hash].js').end();
  }
}
å¤åˆ¶ä»£ç 
```

#### 4.2 Nginxçš„ç¼“å­˜

â€¢ é…ç½®expires

å‡è®¾æˆ‘æƒ³é€šè¿‡webåº”ç”¨çš„å›¾ç‰‡ç¼“å­˜ä¸€å‘¨ï¼Œé‚£ä½ å¯ä»¥åœ¨nginxä¸­é…ç½®å¦‚ä¸‹ğŸ‘‡ï¼Œé…ç½®å®Œä¹‹åä¸€å‘¨ä¹‹å†…çš„èµ„æºåªä¼šè®¿é—®æµè§ˆå™¨çš„èµ„æºï¼Œè€Œä¸æ˜¯å»è¯·æ±‚Nginx

```
 location ~ \.(gif|jpg|jpeg|png)$ {
          root  /var/mywww/html/public/
          expires 7d;  //è¡¨ç¤ºæŠŠæ•°æ®ç¼“å­˜7å¤©ï¼Œdï¼šå¤©ï¼Œsï¼šç§’ï¼Œmï¼šåˆ†
  }
å¤åˆ¶ä»£ç 
```

- è®¾ç½® etag

```
 location ~ \.(gif|jpg|jpeg|png)$ {
          root  /var/mywww/html/public/
          etag		off;  // é»˜è®¤æ˜¯å¼€å¯ on
  }
```

